# 第三空間（病房 702）錯誤修正報告

## 發現的錯誤總結

共發現 **6 個主要錯誤**，分為兩大類：
1. **座標重疊問題**（4 個）
2. **程式邏輯問題**（2 個）

---

## 發現的錯誤

### 1. 座標重疊問題（4 個錯誤）

#### 錯誤 1-1：pillow 和 bedside_table 重疊
- **問題**：`pillow` [0.2, 0.3, 0.4, 0.5] 和 `bedside_table` [0.15, 0.5, 0.3, 0.65] 在邊界重疊
- **影響**：點擊邊界區域時可能觸發錯誤的 hotspot
- **修正**：
  - `pillow`: [0.2, 0.25, 0.4, 0.45]（上移 5%）
  - `bedside_table`: [0.1, 0.5, 0.25, 0.65]（左移 5%，縮小）

#### 錯誤 1-2：recorder_spot 和 bedside_table 重疊
- **問題**：`recorder_spot` [0.1, 0.6, 0.3, 0.7] 和 `bedside_table` [0.15, 0.5, 0.3, 0.65] 在 x 軸和 y 軸都有重疊
- **影響**：點擊重疊區域時可能觸發錯誤的 hotspot
- **修正**：
  - `recorder_spot`: [0.05, 0.6, 0.2, 0.7]（左移 5%，縮小）
  - `bedside_table`: [0.1, 0.5, 0.25, 0.65]（左移 5%，縮小）

#### 錯誤 1-3：sofa_gap 和 carpet_fray 重疊
- **問題**：`sofa_gap` [0.3, 0.6, 0.45, 0.75] 和 `carpet_fray` [0.4, 0.65, 0.6, 0.75] 在 y 軸和 x 軸都有重疊
- **影響**：點擊重疊區域時可能觸發錯誤的 hotspot
- **修正**：
  - `sofa_gap`: [0.3, 0.6, 0.45, 0.75]（保持不變）
  - `carpet_fray`: [0.45, 0.65, 0.65, 0.75]（右移 5%，避免重疊）

#### 錯誤 1-4：monitor 和 wardrobe 重疊
- **問題**：`monitor` [0.6, 0.1, 0.9, 0.3] 和 `wardrobe` [0.5, 0.2, 0.8, 0.6] 在 x 軸和 y 軸都有重疊
- **影響**：點擊重疊區域時可能觸發錯誤的 hotspot
- **修正**：
  - `monitor`: [0.6, 0.05, 0.9, 0.2]（上移 5%）
  - `wardrobe`: [0.5, 0.25, 0.8, 0.6]（下移 5%，避免重疊）

#### 錯誤 1-5：size_tag 位置調整
- **問題**：`size_tag` 在衣櫃內，但座標需要與調整後的 `wardrobe` 對齊
- **修正**：
  - `size_tag`: [0.52, 0.28, 0.58, 0.38]（微調位置，確保在衣櫃內）

---

### 2. 程式邏輯問題

#### 錯誤 2-1：缺少特殊處理邏輯
- **問題**：`recorder_spot`, `pillow`, `bedside_table`, `wardrobe`, `monitor`, `sofa_gap` 這些 hotspot 沒有特殊處理邏輯，直接進入 `interactWithHotspot`，可能導致邏輯混亂
- **影響**：無法正確觸發事件，或觸發錯誤的事件
- **修正**：為每個 hotspot 添加特殊處理邏輯，確保：
  - 正確檢查前置條件
  - 正確觸發對應事件
  - 正確顯示對話或提示
  - 避免重複觸發

#### 錯誤 2-2：監控激活事件處理不完整
- **問題**：監控激活事件返回的廣播對話沒有使用統一的 `handleBroadcast` 處理
- **影響**：廣播可能沒有正確播放音效和閃爍效果
- **修正**：在監控激活的特殊處理中，檢查廣播類型對話並使用 `handleBroadcast` 處理

#### 錯誤 2-3：音效觸發邏輯位置不當
- **問題**：音效觸發邏輯在特殊處理之前，可能在不滿足條件時也會播放音效
- **影響**：音效可能在錯誤的時機播放，或在不應該播放時播放
- **修正**：將音效觸發邏輯整合到特殊處理邏輯內部，確保只有在正確觸發事件時才播放音效

---

## 修正後的座標

| Hotspot ID | 修正前座標 | 修正後座標 | 說明 |
|-----------|-----------|-----------|------|
| `recorder_spot` | [0.1, 0.6, 0.3, 0.7] | [0.05, 0.6, 0.2, 0.7] | 左移 5%，縮小 |
| `pillow` | [0.2, 0.3, 0.4, 0.5] | [0.2, 0.25, 0.4, 0.45] | 上移 5% |
| `bedside_table` | [0.15, 0.5, 0.3, 0.65] | [0.1, 0.5, 0.25, 0.65] | 左移 5%，縮小 |
| `wardrobe` | [0.5, 0.2, 0.8, 0.6] | [0.5, 0.25, 0.8, 0.6] | 下移 5% |
| `monitor` | [0.6, 0.1, 0.9, 0.3] | [0.6, 0.05, 0.9, 0.2] | 上移 5% |
| `sofa_gap` | [0.3, 0.6, 0.45, 0.75] | [0.3, 0.6, 0.45, 0.75] | 保持不變 |
| `window` | [0.7, 0.5, 0.95, 0.8] | [0.7, 0.5, 0.95, 0.8] | 保持不變 |
| `size_tag` | [0.52, 0.25, 0.58, 0.35] | [0.52, 0.28, 0.58, 0.38] | 微調位置 |
| `carpet_fray` | [0.4, 0.65, 0.6, 0.75] | [0.45, 0.65, 0.65, 0.75] | 右移 5% |

---

## 修正後的邏輯流程

### recorder_spot（錄音筆）
1. 檢查是否已收集 → 顯示提示
2. 記錄互動 → 觸發 `pickup_recorder` 事件
3. 顯示對話或提示

### pillow（枕頭）
1. 檢查是否已收集日記 → 顯示提示
2. 記錄互動 → 觸發 `pickup_diary` 事件
3. 顯示對話或提示

### bedside_table（床頭櫃）
1. 檢查是否已收集同意書 → 顯示提示
2. 記錄互動 → 觸發 `pickup_consent_form` 事件
3. 顯示對話或提示

### wardrobe（衣櫃）
1. 檢查是否已閱讀日記 → 提示先探索
2. 檢查是否已觸發跳嚇 → 顯示提示
3. 記錄互動 → 觸發 `wardrobe_jump_scare` 事件
4. 顯示對話或提示

### monitor（監控螢幕）
1. 檢查是否已觸發跳嚇 → 提示先探索
2. 檢查是否已激活監控 → 顯示提示
3. 記錄互動 → 觸發 `monitor_activation` 事件
4. 檢查廣播對話 → 使用 `handleBroadcast` 處理
5. 顯示對話或提示

### sofa_gap（沙發縫隙）
1. 檢查是否已獲得線索 → 提示先查看其他線索
2. 檢查是否已獲得手把 → 顯示提示
3. 記錄互動 → 觸發 `find_handle` 事件
4. 顯示對話或提示

### window（落地窗）
- 已有特殊處理邏輯，保持不變

---

## 測試建議

1. **座標測試**：確認所有 hotspot 不再重疊，點擊時觸發正確的互動
2. **邏輯測試**：按照正確順序觸發所有事件，確認前置條件檢查正確
3. **重複觸發測試**：確認已收集的道具或已觸發的事件不會重複觸發
4. **廣播測試**：確認監控激活時的廣播正確播放音效和閃爍效果

---

## 修正檔案

- `data/gameData.ts`：修正 hotspot 座標
- `app/play/[chapterId]/[sceneId]/page.tsx`：添加特殊處理邏輯

